<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏•‡∏¥‡∏õ‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">
    <!-- Navbar -->
    <nav class="bg-blue-600 text-white p-3 shadow-md">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-lg font-bold">TOPUP ONLINE</h1>
            <div class="flex space-x-4">
                <a href="index.html" class="hover:underline">‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</a>
                <a href="totalGames.html" class="hover:underline">‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô</a>
                <a href="contact.html" class="hover:underline">‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏£‡∏≤</a>
                <a href="about.html" class="hover:underline">‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡πÄ‡∏£‡∏≤</a>
            </div>
            <div class="flex space-x-4" id="user-section">
                <button id="login-btn" onclick="goToLogin()" class="text-white text-2xl">üë§</button>
            </div>
        </div>
    </nav>

    <!-- ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤ -->
    <div class="container mx-auto p-6 bg-white rounded-lg shadow-lg mt-6">
        <h2 class="text-xl font-bold text-center mb-4">üì§ ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏•‡∏¥‡∏õ‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</h2>

        <!-- ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ -->
        <div class="p-4 border rounded-lg bg-gray-100">
            <p class="text-lg font-bold" id="product-name">üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>
            <p class="text-md text-gray-700" id="product-price">üí∞ ‡∏£‡∏≤‡∏Ñ‡∏≤: - ‡∏ö‡∏≤‡∏ó</p>
            <p class="text-md text-gray-700" id="payment-method">üí≥ ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô: -</p>
        </div>

        <!-- ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô -->
        <h3 class="text-lg font-bold mt-6">üìé ‡πÅ‡∏ô‡∏ö‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô</h3>
        <input type="file" id="slip-upload" class="border p-2 rounded w-full mt-2">

        <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô -->
        <div class="text-center mt-6">
            <button id="confirm-payment" class="bg-gray-400 text-white px-6 py-2 rounded-lg text-lg cursor-not-allowed" disabled>
                ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô
            </button>
        </div>
    </div>

    <!-- ‚úÖ ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Å‡∏•‡∏≤‡∏á‡∏à‡∏≠ -->
    <div id="payment-modal" class="fixed inset-0 flex items-center justify-center bg-gray-900 bg-opacity-50 hidden">
        <div class="bg-white p-6 rounded-lg shadow-lg text-center">
            <p class="text-lg font-bold">‚úÖ ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£!</p>
            <p class="text-gray-600">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏û‡∏≤‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥...</p>
            <button onclick="closeModal()" class="bg-blue-600 text-white px-4 py-2 rounded mt-4">‡∏ï‡∏Å‡∏•‡∏á</button>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            loadPaymentDetails();

            // ‚úÖ ‡∏õ‡∏∏‡πà‡∏°‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô
            const confirmBtn = document.getElementById("confirm-payment");
            const slipUpload = document.getElementById("slip-upload");

            // ‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á
            slipUpload.addEventListener("change", function() {
                if (this.files.length > 0) {
                    confirmBtn.disabled = false;
                    confirmBtn.classList.remove("bg-gray-400", "cursor-not-allowed");
                    confirmBtn.classList.add("bg-blue-600", "hover:bg-blue-700", "cursor-pointer");
                } else {
                    confirmBtn.disabled = true;
                    confirmBtn.classList.remove("bg-blue-600", "hover:bg-blue-700", "cursor-pointer");
                    confirmBtn.classList.add("bg-gray-400", "cursor-not-allowed");
                }
            });

            // ‚úÖ ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏´‡πâ‡∏Ç‡∏∂‡πâ‡∏ô‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
            confirmBtn.addEventListener("click", showPaymentModal);
        });

        // ‚úÖ ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏à‡∏≤‡∏Å URL
        async function loadPaymentDetails() {
            const urlParams = new URLSearchParams(window.location.search);
            const productId = urlParams.get("productId");
            const method = urlParams.get("method");

            if (!productId) {
                document.getElementById("product-name").innerText = "‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤";
                document.getElementById("product-price").innerText = "üí∞ ‡∏£‡∏≤‡∏Ñ‡∏≤: - ‡∏ö‡∏≤‡∏ó";
                return;
            }

            try {
                let res = await fetch(`http://localhost:3000/products/${productId}`);
                if (!res.ok) throw new Error("‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");

                let product = await res.json();
                console.log("üì¶ ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏î‡∏∂‡∏á‡∏°‡∏≤:", product);

                if (!product || Object.keys(product).length === 0) {
                    document.getElementById("product-name").innerText = "‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤";
                    document.getElementById("product-price").innerText = "üí∞ ‡∏£‡∏≤‡∏Ñ‡∏≤: - ‡∏ö‡∏≤‡∏ó";
                    return;
                }

                document.getElementById("product-name").innerText = product.name;
                document.getElementById("product-price").innerText = `üí∞ ‡∏£‡∏≤‡∏Ñ‡∏≤: ${product.price} ‡∏ö‡∏≤‡∏ó`;
                document.getElementById("payment-method").innerText = `üí≥ ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô: ${method === "promptpay" ? "QR Code (PromptPay)" : "‡∏ö‡∏±‡∏ï‡∏£‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï/‡πÄ‡∏î‡∏ö‡∏¥‡∏ï"}`;
            } catch (error) {
                console.error("‚ùå ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:", error);
                alert("‚ùå ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡πÇ‡∏õ‡∏£‡∏î‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á");
            }
        }

        // ‚úÖ ‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Å‡∏•‡∏≤‡∏á‡∏à‡∏≠
        function showPaymentModal() {
            document.getElementById("payment-modal").classList.remove("hidden");

            // ‚è≥ ‡∏£‡∏≠ 3 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ ‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ `index.html`
            setTimeout(() => {
                window.location.href = "index.html";
            }, 3000);
        }

        // ‚úÖ ‡∏õ‡∏¥‡∏î‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ñ‡πâ‡∏≤‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡∏ï‡∏Å‡∏•‡∏á"
        function closeModal() {
            document.getElementById("payment-modal").classList.add("hidden");
            window.location.href = "index.html";
        }

        function goToLogin() {
            window.location.href = "login.html";
        }
    </script>
</body>
</html>
